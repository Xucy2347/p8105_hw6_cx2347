p8105_hw6_cx2347
================
Chuyuan XU
2025-11-27

``` r
library(tidyverse)
library(stringr)
library(broom)
library(patchwork)
library(rvest)
library(httr)

knitr::opts_chunk$set(
  fig.width = 8,
  fig.asp = 0.9,
  out.width = "90%"
)
```

### Problem 1

``` r
csv = "https://raw.githubusercontent.com/washingtonpost/data-homicides/refs/heads/master/homicide-data.csv"

homicide_raw = read_csv(csv, na=c("NA", "", "."))
```

``` r
homicide_df = homicide_raw |>
  janitor::clean_names() |>
  
  # Create a city_state variable (e.g. “Baltimore, MD”)
  mutate(city_state = str_c(city, ', ', state)) |>
  
  # omit Dallas, TX; Phoenix, AZ; Kansas City, MO; Tulsa, AL
  filter(
    !city_state %in% c("Dallas, TX", "Phoenix, AZ", "Kansas City, MO", "Tulsa, AL")
  ) |>
  
  # limit the data among those for whom victim_race is white or black
  filter(
    victim_race %in% c("White", "Black")
  ) |>
  
  # change the victims' age into numbers
  # change the unknown victims' sex into NA
  # change the victim_race into a factor
  # create a indicator for resolved vs unresolved
  mutate(
    victim_age = if_else(victim_age == "Unknown", NA , victim_age),
    victim_age = as.numeric(victim_age),
    victim_sex =  if_else(victim_sex == "Unknown", NA , victim_sex),
    victim_race = fct_relevel(victim_race, "White"),
    resolved = as.numeric(disposition == "Closed by arrest")
  )
```

``` r
# fit a logistic regression with resolved vs unresolved as the outcome and victim age, sex and race as predictors
fit_balt = homicide_df |>
  filter(city == "Baltimore") |>
  glm(
    resolved ~ victim_age + victim_race + victim_sex, 
    data = _,
    family = binomial()
  )

fit_balt_df = fit_balt |> 
  broom::tidy() |> 
  mutate(
    OR = exp(estimate),
    CI_l = exp(estimate - 1.96*std.error),
    CI_u = exp(estimate + 1.96*std.error),
  ) |>
  select(term, OR, CI_l, CI_u, p.value) 

fit_balt_df |> 
  mutate(
    CI_l = round(CI_l, 3),
    CI_u = round(CI_u, 3), 
  ) |>
  nest(CI = c("CI_l", "CI_u")) |>
  select(term, OR, CI, p.value) |>
  knitr::kable(
    digits = 3,
    col.names = c("terms", "est OR", "95% CI (OR)", "P-value"),
    align = 'r'
  )
```

|            terms | est OR |  95% CI (OR) | P-value |
|-----------------:|-------:|-------------:|--------:|
|      (Intercept) |  3.164 | 1.989, 5.031 |   0.000 |
|       victim_age |  0.993 | 0.987, 1.000 |   0.043 |
| victim_raceBlack |  0.431 | 0.306, 0.607 |   0.000 |
|   victim_sexMale |  0.426 | 0.325, 0.558 |   0.000 |

The estimated adjusted odds ratio for solving homicides comparing male
victims to female victims keeping all other variables fixed is
0.4255117, with a 95% confidence interval of (0.325, 0.558).
